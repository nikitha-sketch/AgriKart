<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pesticides - AgriKart</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
.card {
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.card:hover {
  transform: scale(1.05);
  box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
}
</style>

</head>
<body class="bg-green-50 text-gray-900">

<header class="bg-green-700 text-white flex justify-between items-center p-4">
  <h1 class="text-2xl font-bold">AgriKart - Pesticides</h1>
  
  <nav class="flex items-center space-x-6">
    <a href="index.html" class="hover:underline">Home</a>

    <div class="relative group">
      <button class="hover:underline focus:outline-none">Products</button>
      <div class="absolute left-0 bg-white text-black mt-2 rounded shadow-lg hidden group-hover:flex flex-col z-10">
        <a href="fertilizers.html" class="block px-4 py-2 hover:bg-green-100">Fertilizers</a>
        <a href="pesticides1.html" class="block px-4 py-2 hover:bg-green-100">Pesticides</a>
        <a href="seeds.html" class="block px-4 py-2 hover:bg-green-100">Seeds</a>
        <a href="tools.html" class="block px-4 py-2 hover:bg-green-100">Tools</a>
      </div>
    </div>

    <input
      type="text"
      id="searchInput"
      placeholder="Search pesticides..."
      class="p-2 rounded text-black"
      oninput="filterPesticides()"
    />
    
    <button onclick="logout()" class="bg-red-600 px-4 py-2 rounded hover:bg-red-700">Logout</button>
  </nav>
</header>

  <section id="pesticideGrid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 p-6">
    <!-- Cards inserted by JS -->
  </section>

  <div class="flex justify-center space-x-3 mb-10" id="pagination"></div>

  <footer class="text-center py-4 bg-gray-100 text-sm">
    © 2025 AgriKart. All rights reserved.
  </footer>
  <script>
    let pesticides = [];
    let filteredPesticides = [];
    const itemsPerPage = 4;
    let currentPage = 1;

    async function loadPesticidesFromBackend() {
      try {
        //const res = await fetch("http://localhost:8080/api/products?category=Pesticides");
		const res = await fetch("http://localhost:8080/api/products/category?name=Pesticides");
        const data = await res.json();
		pesticides = data.map(p => ({
		  productId: p.id,
		  code: p.code,
		  name: `${p.name} (${p.code})`,
		  image: p.imageUrl,
		  
		  use: p.use || 'No info',

		  cause: p.cause || "Detailed description not available.",
		
		  price: `₹${p.price}`,
		  delivery: p.delivery && p.delivery.trim() !== "" ? p.delivery : "1-2 days"
		}));

        filteredPesticides = [...pesticides];
        displayPesticides();
      } catch (error) {
        console.error("Error loading pesticides:", error);
      }
    }

    function displayPesticides(page = 1) {
      currentPage = page;
      const pesticideGrid = document.getElementById('pesticideGrid');
      pesticideGrid.innerHTML = '';
      const start = (page - 1) * itemsPerPage;
      const end = start + itemsPerPage;
      const pageItems = filteredPesticides.slice(start, end);

      pageItems.forEach(p => {
        const smsMessage = `I want to order ${p.name} (Code: ${p.code}) priced at ${p.price}.`;
        const card = document.createElement('div');
        card.className = 'bg-white p-4 rounded-lg shadow card flex flex-col justify-between h-full';

        card.innerHTML = `
          <img src="${p.image}" alt="${p.name}" class="h-48 w-full object-contain rounded-md mb-3" />
          <h2 class="text-xl font-semibold">${p.name}</h2>
          <p class="text-sm mt-1 font-semibold">Product Code: <span class="font-normal">${p.code}</span></p>
          <p class="text-sm mt-1 font-semibold">Use: <span class="font-normal">${p.use}</span></p>
          <p class="text-sm mt-1 font-semibold">Cause: <span class="font-normal">${p.cause}</span></p>
          <p class="text-sm mt-1 font-semibold">Price: <span class="font-normal">${p.price}</span></p>
          <p class="text-sm mt-1 font-semibold">Delivery: <span class="font-normal">${p.delivery}</span></p>

          <button onclick='placeOrder(${JSON.stringify(p)})' class="mt-3 bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
            Place Order
          </button>

          <div class="flex justify-between gap-2 mt-3">
            <a href="tel:+919876543210" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-center w-1/2">
              Call to Order
            </a>
            <a href="sms:+919876543210?body=${encodeURIComponent(smsMessage)}" class="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded text-center w-1/2">
              SMS to Order
            </a>
          </div>
        `;
        pesticideGrid.appendChild(card);
      });

      setupPagination();
    }

    function setupPagination() {
      const pagination = document.getElementById('pagination');
      pagination.innerHTML = '';
      const totalPages = Math.ceil(filteredPesticides.length / itemsPerPage);

      for (let i = 1; i <= totalPages; i++) {
        const btn = document.createElement('button');
        btn.textContent = i;
        btn.className = `px-4 py-2 rounded ${i === currentPage ? 'bg-green-700 text-white' : 'bg-green-300 text-green-900 hover:bg-green-500'}`;
        btn.onclick = () => displayPesticides(i);
        pagination.appendChild(btn);
      }
    }

    function filterPesticides() {
      const query = document.getElementById('searchInput')?.value.toLowerCase() || '';
      filteredPesticides = pesticides.filter(p =>
        p.name.toLowerCase().includes(query) ||
        p.code.toLowerCase().includes(query) ||
        p.use.toLowerCase().includes(query) ||
        p.cause.toLowerCase().includes(query)
      );
      displayPesticides(1);
    }

    function placeOrder(item) {
      let cart = JSON.parse(localStorage.getItem("cart")) || [];

      const newItem = {
        id: item.productId,
        code: item.code,
        name: item.name,
        image: item.image,
        price: item.price,
        category: "Pesticides",
        quantity: 1
      };

      cart.push(newItem);
      localStorage.setItem("cart", JSON.stringify(cart));
      alert(`${item.name} added to cart!`);
      window.location.href = "cart.html";
    }

    function logout() {
      alert("Logging out...");
      window.location.href = "login.html";
    }

    // Load pesticides on page load
    document.addEventListener("DOMContentLoaded", loadPesticidesFromBackend);
  </script>


</body>
</html>
